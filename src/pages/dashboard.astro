---
import MainLayout from '../layouts/MainLayout.astro'
import DashboardComponent from '../components/Dashboard/Dashboard'
import AdminCrud from '../components/Admins/AdminCrud'
import { supabase } from '../db/supabase'

// Verificar si hay una sesi√≥n v√°lida
const {
  data: { session }
} = await supabase.auth.getSession()

if (!session) {
  return Astro.redirect(
    '/signin?error=' +
      encodeURIComponent('Debes iniciar sesi√≥n para acceder al dashboard')
  )
}

// Obtener los art√≠culos
const { data: articulos, error } = await supabase.from('Articulos').select('*')

const { data: users_roles, error: users_roles_error } = await supabase
  .from('users_roles')
  .select('*')
console.log('üöÄ ~ users_roles:', users_roles)

if (error) {
  console.error('Error al obtener los art√≠culos:', error)
}
---

<MainLayout
  title='Dashboard'
  description='CRUD de Art√≠culos'
  dashboard={true}
>
  <DashboardComponent
    client:load
    articulos={articulos || []}
  />
  <AdminCrud
    client:load
    users_roles={users_roles}
  />
</MainLayout>

<style>
  body {
    background-color: #f3f4f6;
  }
</style>
